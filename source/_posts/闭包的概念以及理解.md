---
title: 闭包的概念以及理解
date: 2016-10-10 15:49:06
tags: js
---
### 闭包优点
1. 可以读取函数内部的变量，
2. 让这些变量的值始终保持在内存中。
### 闭包缺点
1. 不必要的闭包造成内存泄漏。

### 代码1
```javascript
let x = void 0;
function f1() {
    var n = 999;
     x = function () { n += 1 };
    function f2() {
        console.log(n);
    }
    return f2;
}

var result = f1();

result();//999

x();

result();// 1000
```
1. 在这段代码中，result实际上就是闭包f2函数。它一共运行了两次，第一次的值是999，第二次的值是1000。这证明了，函数f1中的局部变量n一直保存在内存中，并没有在f1调用后被自动清除。
2. 为什么会这样呢？原因就在于f1是f2的父函数，而f2被赋给了一个全局变量，这导致f2始终在内存中，而f2的存在依赖于f1，因此f1也始终在内存中，不会在调用结束后，被垃圾回收机制（garbage collection）回收。
3. 这段代码中另一个值得注意的地方，就是"nAdd=function(){n+=1}"这一行，首先在nAdd前面没有使用var关键字，因此nAdd是一个全局变量，而不是局部变量。其次，nAdd的值是一个匿名函数（anonymous function），而这个匿名函数本身也是一个闭包，所以nAdd相当于是一个setter，可以在函数外部对函数内部的局部变量进行操作。
### 代码2
```javascript
for(var i = 0; i < 5; i++) {
    setTimeout(function() {
        console.log(i);
    }, 0);
};
// 结果：5 5 5 5 5 
```
```javascript
for(var i = 0; i < 5; i++) {
    (function (a) {
        setTimeout(function() {
            console.log(a);
        }, 0);
    })(i);
};
// 结果： 0 1 2 3 4 
```
```javascript
for(let i = 0; i < 5; i++) {
    setTimeout(function() {
        console.log(i);
    }, 0);
};
// 结果： 0 1 2 3 4 
```
1. 在第一个中，i为一个引用，但是第二个，function中为值传递，创建闭包将其作为块级作用域，其中let就是块级作用域，所以也可以达到这个效果。
